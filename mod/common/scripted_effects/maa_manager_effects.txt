######################################################
# MAA Manager - Helper Effects for Scripted GUIs
######################################################

maa_manager_data_create_effect = {
	# Clear any previously collected data to ensure a fresh list
	clear_variable_list = maa_regiment_list
	clear_variable_list = maa_move_target_list
	clear_saved_scope = maa_manager_selected_regiment
	save_scope_value_as = {
		name = maa_manager_selected_type
		value = flag:_maa_manager_unset
	}
	remove_global_variable = maa_manager_move_has_targets
	
	# Clear retrain-specific variables to ensure clean state
	remove_variable = maa_manager_selected_regiment_scope
	remove_variable = maa_manager_retrain_target_type
	remove_variable = maa_manager_target_cost
	remove_variable = maa_manager_source_cost
	
	# Iterate through all of the character's MAA regiments
	every_maa_regiment = {
		ROOT = {
			add_to_variable_list = {
				name = maa_regiment_list
				target = prev
			}
		}
	}
}

maa_manager_select_regiment_effect = {
	clear_variable_list = maa_move_target_list
	remove_global_variable = maa_manager_move_has_targets
	scope:regiment = {
		save_scope_as = maa_manager_selected_regiment
		ROOT = {
			set_variable = {
				name = maa_manager_selected_regiment_scope
				value = scope:regiment
			}
		}
		maa_manager_store_selected_type = yes
	}
	every_maa_regiment = {
		if = {
			limit = {
				NOT = {
					this = scope:maa_manager_selected_regiment
				}
				maa_manager_type_matches_selection = yes
			}
			ROOT = {
				add_to_variable_list = {
					name = maa_move_target_list
					target = prev
				}
				set_global_variable = {
					name = maa_manager_move_has_targets
					value = yes
				}
			}
		}
	}
}


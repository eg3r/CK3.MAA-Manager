######################################################
# Men-At-Arms Manager - MAA Type Recruitment Triggers
#
# STATUS: Only 4 base types enabled for testing
# See: documentation/MAA_IMPLEMENTATION_PROGRESS.md
######################################################
####### BASE TYPES - TESTING (4 types) #######
maa_manager_can_recruit_light_footmen = {
	NOR = {
		government_has_flag = government_is_nomadic
		government_has_flag = government_is_herder
	}
}

maa_manager_can_recruit_bowmen = {
	NOR = {
		government_has_flag = government_is_nomadic
		government_has_flag = government_is_herder
	}
}

maa_manager_can_recruit_light_horsemen = {
	NOR = {
		government_has_flag = government_is_nomadic
		government_has_flag = government_is_herder
	}
}

maa_manager_can_recruit_pikemen_unit = {
	NOR = {
		government_has_flag = government_is_nomadic
		government_has_flag = government_is_herder
	}
}

####### ALL OTHER TYPES - DISABLED #######
# Enable after testing - see backup file for implementations
maa_manager_can_recruit_armored_footmen = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement
	culture = {
		has_innovation = innovation_quilted_armor
	}
	# Cultural parameter check - some cultures ban heavy MAA
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_armored_horsemen = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement
	culture = {
		has_innovation = innovation_arched_saddle
	}
}

maa_manager_can_recruit_crossbowmen = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement
	culture = {
		has_innovation = innovation_advanced_bowmaking
	}
}

maa_manager_can_recruit_onager = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement - Tribal Era siege weapon
	culture = {
		has_innovation = innovation_catapult
	}
}

maa_manager_can_recruit_mangonel = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement - Early Medieval siege weapon
	culture = {
		has_innovation = innovation_mangonel
	}
}

maa_manager_can_recruit_trebuchet = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement - High Medieval siege weapon
	culture = {
		has_innovation = innovation_trebuchet
	}
}

maa_manager_can_recruit_bombard = {
	# Base government check - exclude nomadic and herder governments
	trigger_if = {
		limit = {
			OR = {
				government_has_flag = government_is_nomadic
				government_has_flag = government_is_herder
			}
		}
		always = no
	}
	# Innovation requirement - Late Medieval siege weapon
	culture = {
		has_innovation = innovation_bombard
	}
}

maa_manager_can_recruit_house_guard = {
	# Must have a dynasty
	exists = dynasty
	# Dynasty must have warfare legacy perk 5
	dynasty = {
		has_dynasty_perk = warfare_legacy_5
	}
	# Cultural parameter check - some cultures ban heavy MAA
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_camel_rider = {
	# Regional innovation requirement
	# Direct culture access - we're in character scope from scripted GUI
	culture = {
		has_innovation = innovation_war_camels
	}
}

maa_manager_can_recruit_war_elephant = {
	# Must have innovation OR special adventurer parameter
	OR = {
		AND = {
			# Regular recruitment path
			culture = {
				has_innovation = innovation_elephantry
			}
			# Exclude landless adventurers (unless they have special parameter)
			NOT = {
				is_landless_adventurer = yes
			}
		}
		# Adventurer special parameter path, can have no domicile?
		domicile ?= {
			has_domicile_parameter = camp_reinforce_elephant_regiments_anywhere
		}
	}
}

# Cultural/Traditional MAA Types
# 24 types with tradition requirements, 14 types available to all
maa_manager_can_recruit_huscarl = {
	culture = {
		has_cultural_parameter = unlock_maa_huscarls
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_landsknecht = {
	culture = {
		has_innovation = innovation_zweihanders
	}
}

maa_manager_can_recruit_longbowmen = {
	culture = {
		has_cultural_parameter = unlock_maa_longbowmen
	}
}

maa_manager_can_recruit_goedendag = {
	culture = {
		has_innovation = innovation_adaptive_militia
	}
}

maa_manager_can_recruit_gendarme = {
	culture = {
		has_innovation = innovation_valets
	}
}

maa_manager_can_recruit_chasseur = {
	culture = {
		has_innovation = innovation_desert_tactics
	}
}

maa_manager_can_recruit_picchieri = {
	culture = {
		has_innovation = innovation_pike_columns
	}
}

maa_manager_can_recruit_praetorian = {
	culture = {
		has_innovation = innovation_legionnaires
	}
}

maa_manager_can_recruit_caballero = {
	culture = {
		has_innovation = innovation_caballeros
	}
}

maa_manager_can_recruit_monaspa = {
	culture = {
		has_cultural_parameter = unlock_maa_monaspa
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_cataphract = {
	culture = {
		has_cultural_parameter = unlock_maa_cataphract
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_hobelar = {
	culture = {
		has_innovation = innovation_hobbies
	}
}

maa_manager_can_recruit_schiltron = {
	culture = {
		has_innovation = innovation_rectilinear_schiltron
	}
}

maa_manager_can_recruit_metsanvartija = {
	culture = {
		has_cultural_parameter = unlock_maa_metsanvartija
	}
}

maa_manager_can_recruit_horse_archers = {
	culture = {
		has_cultural_parameter = unlock_maa_horse_archers
	}
}

maa_manager_can_recruit_ayyar = {
	culture = {
		has_cultural_parameter = unlock_maa_ayyar
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_mubarizun = {
	culture = {
		has_cultural_parameter = unlock_maa_mubarizun
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_mulaththamun = {
	culture = {
		has_cultural_parameter = unlock_maa_mulaththamun
	}
}

maa_manager_can_recruit_archers_of_the_nile = {
	culture = {
		has_cultural_parameter = unlock_maa_archers_of_the_nile
	}
}

maa_manager_can_recruit_paiks = {
	culture = {
		has_innovation = innovation_bamboo_bows
	}
}

maa_manager_can_recruit_druzhina = {
	culture = {
		has_cultural_parameter = unlock_maa_druzhina
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_hussar = {
	culture = {
		has_cultural_parameter = unlock_maa_hussar
	}
}

maa_manager_can_recruit_horn_warrior = {
	culture = {
		has_cultural_parameter = unlock_maa_horn_warrior
	}
}

maa_manager_can_recruit_bush_hunter = {
	culture = {
		has_cultural_parameter = unlock_maa_bush_hunter
	}
}

maa_manager_can_recruit_shomer = {
	culture = {
		has_cultural_parameter = unlock_maa_shomer
	}
}

maa_manager_can_recruit_garudas = {
	culture = {
		has_cultural_parameter = unlock_maa_garudas
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_khandayat = {
	culture = {
		has_cultural_parameter = unlock_maa_khandayat
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_mountaineer = {
	culture = {
		has_cultural_parameter = unlock_maa_mountaineer
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_sahel_horsemen = {
	culture = {
		has_innovation = innovation_sahel_horsemen
	}
}

maa_manager_can_recruit_guinea_warrior = {
	culture = {
		has_cultural_parameter = unlock_maa_guinea_warrior
	}
}

maa_manager_can_recruit_sarawit = {
	culture = {
		has_innovation = innovation_sarawit
	}
}

maa_manager_can_recruit_abudrar = {
	culture = {
		has_cultural_parameter = unlock_maa_abudrar
	}
}

maa_manager_can_recruit_zbrojnosh = {
	culture = {
		has_cultural_parameter = unlock_maa_zbrojnosh
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_palace_guards = {
	culture = {
		has_cultural_parameter = unlock_maa_palace_guards
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_chu_ko_nu = {
	culture = {
		has_innovation = innovation_repeating_crossbow
	}
}

maa_manager_can_recruit_guanch_vaulter = {
	culture = {
		has_innovation = innovation_pole_vault
	}
}

maa_manager_can_recruit_vigmen = {
	culture = {
		has_cultural_parameter = unlock_maa_vigmen
	}
}

maa_manager_can_recruit_bondi = {
	culture = {
		has_cultural_parameter = unlock_maa_bondi
	}
}

maa_manager_can_recruit_varangian_veterans = {
	culture = {
		has_cultural_parameter = unlock_maa_varangian_veterans
		NOT = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_jomsviking_pirates = {
	always = no	# Not manually recruitable in base game
}

# Accolade MAA Types - Require rank 3+ accolade with matching attribute + only 1 active regiment allowed
maa_manager_can_recruit_archers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_archers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:archer_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_skirmishers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_skirmishers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:skirmisher_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_pikes = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_pikes
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:pike_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_outriders = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_outriders
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:outrider_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_vanguards = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_vanguards
		}
	}
	# Check if has required accolade and not banned by culture
	any_active_accolade = {
		limit = {
			primary_type = {
				this = accolade_type:vanguard_attribute
			}
			accolade_rank >= 3
		}
	}
	NOT = {
		culture = {
			has_cultural_parameter = strength_in_numbers_heavy_maa_ban
		}
	}
}

maa_manager_can_recruit_lancers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_lancers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:lancer_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_crossbowers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_crossbowers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:crossbowmen_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_cameliers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_cameliers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:camelry_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_elephantiers = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_elephantiers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:elephantry_attribute
		}
		accolade_rank >= 3
	}
}

maa_manager_can_recruit_horse_archers_retinue = {
	# Check if already has this accolade MAA type active
	NOT = {
		any_maa_regiment = {
			is_maa_type = accolade_maa_horse_archers
		}
	}
	# Check if has required accolade
	any_active_accolade = {
		primary_type = {
			this = accolade_type:horse_archer_attribute
		}
		accolade_rank >= 3
	}
}

######################################################
# BYZANTINE/LEGACY OF ROME (EP3) MAA TYPES
######################################################

maa_manager_can_recruit_ayrudzi = {
	# Requires Armenian cultural tradition: unlock_maa_ayrudzi
	culture = {
		has_cultural_parameter = unlock_maa_ayrudzi
	}
}

maa_manager_can_recruit_conrois = {
	# Requires French/Norman cultural tradition: unlock_maa_conrois
	culture = {
		has_cultural_parameter = unlock_maa_conrois
	}
}

maa_manager_can_recruit_akritai = {
	# Requires Byzantine cultural tradition: unlock_maa_akritai
	culture = {
		has_cultural_parameter = unlock_maa_akritai
	}
}

maa_manager_can_recruit_ballistrai = {
	# Requires Byzantine cultural tradition: unlock_maa_ballistrai
	culture = {
		has_cultural_parameter = unlock_maa_ballistrai
	}
}

maa_manager_can_recruit_skoutatoi = {
	# Requires Byzantine cultural tradition: unlock_maa_skoutatoi
	culture = {
		has_cultural_parameter = unlock_maa_skoutatoi
	}
}

maa_manager_can_recruit_varangian_guards = {
	# Requires founded Varangian Guard (Byzantine special)
	# Note: This is a title-specific check, may not work in retrain context
	# TODO: Investigate proper scope for title check
	exists = primary_title
	primary_title = {
		has_variable = founded_varangian_guard
	}
}

maa_manager_can_recruit_handpicked_faithful = {
	# Requires landless adventurer domicile with specific parameter
	# Note: This check requires domicile system (Landless Adventurers DLC)
	exists = domicile
	domicile = {
		has_domicile_parameter = camp_unlocks_handpicked_faithful_maa_type
	}
}

######################################################
# BLOCKED EP3 MAA TYPES (Not Recruitable)
######################################################

# Outcast/Adventurer MAA - NOT player-recruitable
maa_manager_can_recruit_maa_bandits = {
	always = no
}

maa_manager_can_recruit_maa_poachers = {
	always = no
}

maa_manager_can_recruit_maa_marauders = {
	always = no
}

maa_manager_can_recruit_maa_thieves = {
	always = no
}

maa_manager_can_recruit_teutonic_knights = {
	always = no
}

######################################################
# NOMADIC (MPO) MAA TYPES
######################################################

maa_manager_can_recruit_torch_bearers = {
	# Siege weapon for nomadic government
	government_has_flag = government_is_nomadic
}

maa_manager_can_recruit_kheshig = {
	# Requires dynasty with mpo_nomad_legacy_3 perk (max 1 regiment)
	dynasty ?= {
		has_dynasty_perk = mpo_nomad_legacy_3
	}
}

maa_manager_can_recruit_steppe_raiders = {
	# Basic nomadic MAA - requires nomadic government
	# From game file: mpo_can_recruit_nomad_maa_trigger
	government_has_flag = government_is_nomadic
}

maa_manager_can_recruit_heavy_horse_archers = {
	# Requires nomadic government + domicile unlock
	# From game file: mpo_can_recruit_nomad_maa_trigger + domicile check
	government_has_flag = government_is_nomadic
	exists = domicile
	domicile = {
		has_domicile_parameter = unlock_maa_heavy_horse_archers
	}
}

######################################################
# PERSIA DLC (FP3) MAA TYPES
######################################################
maa_manager_can_recruit_asawira = {
	# Requires dynasty with fp3_khvarenah_legacy_4 perk
	dynasty ?= {
		has_dynasty_perk = fp3_khvarenah_legacy_4
	}
}

maa_manager_can_recruit_tarkhan = {
	# Requires Persian cultural tradition: unlock_maa_tarkhan
	# Note: Landless adventurers with planned_cultivation_perk also handled
	OR = {
		AND = {
			is_landless_adventurer = yes
			has_perk = planned_cultivation_perk
			location.culture ?= {
				has_cultural_parameter = unlock_maa_tarkhan
			}
		}
		culture = {
			has_cultural_parameter = unlock_maa_tarkhan
		}
	}
}

maa_manager_can_recruit_zupin_warrior = {
	# Requires Caucasian cultural tradition: unlock_maa_zupin_warrior
	# Note: Landless adventurers with planned_cultivation_perk also handled
	OR = {
		AND = {
			is_landless_adventurer = yes
			has_perk = planned_cultivation_perk
			location.culture ?= {
				has_cultural_parameter = unlock_maa_zupin_warrior
			}
		}
		culture = {
			has_cultural_parameter = unlock_maa_zupin_warrior
		}
	}
}

maa_manager_can_recruit_tawashi = {
	# Requires Mamluk cultural tradition: unlock_maa_tawashi
	# Note: Landless adventurers with planned_cultivation_perk also handled
	OR = {
		AND = {
			is_landless_adventurer = yes
			has_perk = planned_cultivation_perk
			location.culture ?= {
				has_cultural_parameter = unlock_maa_tawashi
			}
		}
		culture = {
			has_cultural_parameter = unlock_maa_tawashi
		}
	}
}

maa_manager_can_recruit_nomad_lancers = {
	# Requires nomadic government + heavy cavalry unlock (realm law)
	# From game file: mpo_can_recruit_nomad_heavy_cavalry_maa_trigger
	government_has_flag = government_is_nomadic
	has_realm_law_flag = unlock_maa_nomad_lancers
}

maa_manager_can_recruit_mangudai = {
	# Requires Mongolic cultural tradition: unlock_maa_mangudai
	culture = {
		has_cultural_parameter = unlock_maa_mangudai
	}
}

maa_manager_can_recruit_cataphract_archers = {
	# Requires cultural tradition + either non-nomadic OR has dominance
	culture = {
		has_cultural_parameter = unlock_maa_cataphract_archers
	}
	OR = {
		NOT = {
			government_has_flag = government_is_nomadic
		}
		has_realm_law_flag = unlock_maa_nomad_lancers
	}
}

maa_manager_can_recruit_maturkan_warriors = {
	# Requires Caucasian cultural tradition: unlock_maa_maturkan_warriors
	culture = {
		has_cultural_parameter = unlock_maa_maturkan_warriors
	}
}
